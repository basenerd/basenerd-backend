<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Game • Basenerd</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&family=IBM+Plex+Mono:wght@500&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --muted:#5b6577; --text:#111318; --accent:#0b5cab;
      --row:#fafbfc; --rowAlt:#f4f6f9; --border:#e2e8f0;
      --header-bg:#ffffff; --header-text:#0b0e13;
      --chip-live:#e21d48; --chip-final:#32425c; --chip-upcoming:#6b7a94;
      --subtle:#8a94ab;
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:"IBM Plex Sans", system-ui, -apple-system, "Segoe UI", Roboto, Arial; font-size:13.5px; }
    header{ display:flex; align-items:center; gap:10px; padding:12px 16px; background:var(--header-bg); color:var(--header-text); border-bottom:2px solid var(--border); position:sticky; top:0; z-index:10; }
    header img{height:32px}
    header h1{margin:0; font-size:17px; letter-spacing:.2px; font-weight:600}
    .wrap{max-width:1100px; margin:16px auto 80px; padding:0 12px}
    .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden; }
    .row{ display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; padding:8px 12px; }
    .row:nth-child(odd){ background:var(--row); }
    .row:nth-child(even){ background:var(--rowAlt); }
    .team{ display:flex; align-items:center; gap:10px; min-width:0; }
    .iconstack{ display:flex; flex-direction:column; align-items:center; gap:4px; }
    .team img{ height:18px; width:auto; }
    .record{ color:var(--muted); font-size:10px; line-height:1; }
    .abbr{ font-weight:700; letter-spacing:.2px; min-width:26px; }
    .info{ color:#394150; font-size:11.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .right{ text-align:right; font-variant-numeric: tabular-nums; font-family:"IBM Plex Mono", ui-monospace, Menlo, monospace; }
    .score{ font-weight:800; font-size:16px; }
    .chip{ font-size:11px; padding:3px 8px; border-radius:999px; color:#fff; font-weight:700; letter-spacing:.3px; }
    .chip.live{ background:var(--chip-live); }
    .chip.final{ background:var(--chip-final); }
    .chip.upcoming{ background:var(--chip-upcoming); }
    .lastplay{ padding:8px 12px; border-top:1px solid var(--border); background:#fff; font-size:11.5px; color:#394150; }
    .lastplay strong{ color:#5b6577; margin-right:4px; }
    .statcast{ padding:0 12px 8px 12px; font-size:11.5px; color:#394150; }
    details{ padding:8px 12px 12px 12px; border-top:1px solid var(--border); background:#fff; }
    details summary{ cursor:pointer; font-weight:700; color:#32425c; margin:4px 0 8px; }
    .box table, .scoresum table{ border-collapse:collapse; width:100%; font-family:"IBM Plex Mono", ui-monospace, Menlo, monospace; font-size:11.5px; }
    .box thead th, .scoresum thead th{ color:#5b6577; font-weight:700; border-bottom:1px solid var(--border); padding:6px 6px; text-align:center; }
    .box tbody td, .scoresum tbody td{ border-bottom:1px solid var(--border); padding:6px 6px; text-align:center; color:#394150; }
    .box .teamhdr{ text-align:left; font-weight:700; color:#394150; padding:6px; }
    .box td.name, .box th.name{ text-align:left; font-weight:normal; color:#111318; }
    .box td.pos, .box th.pos { color:#8a94ab; font-weight:700; text-transform:uppercase; }
    .two{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media(max-width:700px){ .two{ grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header>
    <a href="/todaysgames" class="details-btn" style="text-decoration:none;border:1px solid var(--border);padding:4px 8px;border-radius:8px;background:#fff;color:#0b5cab;">‹ Back</a>
    <img src="{{ url_for('static', filename='basenerd-logo-official.png') }}" alt="Basenerd" />
    <h1 id="title">Game</h1>
  </header>

  <div class="wrap">
    <article class="card" id="gameCard">
      <header style="padding:10px 12px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)">
        <div>
          <div class="when" id="venue" style="color:#5b6577;font-size:12px"></div>
          <div id="chip" style="margin-top:4px"></div>
        </div>
        <div id="count" style="color:#394150;font-size:11px"></div>
      </header>
      <div id="rows"></div>
      <div id="lastplay"></div>
      <div id="statcast" class="statcast"></div>

      <details id="scoresum"><summary>Score Summary</summary><div class="wrap"></div></details>
      <details id="lineups"><summary>Lineups</summary><div class="two"><div id="luAway"></div><div id="luHome"></div></div></details>
      <details id="box"><summary>Box score</summary>
        <div class="box">
          <div id="linescore"></div>
          <div class="two">
            <div>
              <div class="teamhdr" id="batAwayHdr"></div>
              <table>
                <thead><tr><th class="pos">POS</th><th class="name">Player</th><th>AB</th><th>R</th><th>H</th><th>RBI</th><th>BB</th><th>K</th></tr></thead>
                <tbody id="batAway"></tbody>
              </table>
            </div>
            <div>
              <div class="teamhdr" id="batHomeHdr"></div>
              <table>
                <thead><tr><th class="pos">POS</th><th class="name">Player</th><th>AB</th><th>R</th><th>H</th><th>RBI</th><th>BB</th><th>K</th></tr></thead>
                <tbody id="batHome"></tbody>
              </table>
            </div>
          </div>
          <div class="two" style="margin-top:12px">
            <div>
              <div class="teamhdr" id="pitAwayHdr"></div>
              <table>
                <thead><tr><th class="pos">POS</th><th class="name">Pitcher</th><th>IP</th><th>H</th><th>R</th><th>ER</th><th>BB</th><th>K</th><th>HR</th><th>P</th></tr></thead>
                <tbody id="pitAway"></tbody>
              </table>
            </div>
            <div>
              <div class="teamhdr" id="pitHomeHdr"></div>
              <table>
                <thead><tr><th class="pos">POS</th><th class="name">Pitcher</th><th>IP</th><th>H</th><th>R</th><th>ER</th><th>BB</th><th>K</th><th>HR</th><th>P</th></tr></thead>
                <tbody id="pitHome"></tbody>
              </table>
            </div>
          </div>
        </div>
      </details>
    </article>
  </div>

  <script>
    const gamePk = {{ game_pk }};
    function esc(s){ return String(s||'').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
    async function getGame(){ const r = await fetch(`/api/game/${gamePk}`, {cache:'no-store'}); if(!r.ok) throw new Error('http'); return await r.json(); }

    function chip(status, chip){
      if(status==='in_progress') return `<span class="chip live">Live</span>`;
      if(status==='final') return `<span class="chip final">Final</span>`;
      return `<span class="chip upcoming">${esc(chip||'')}</span>`;
    }
    function teamRow(side, t){
      const score = (t.score!=null)? t.score : '&nbsp;';
      return `<div class="row">
        <div class="team">
          <div class="iconstack">
            ${t.id ? `<img src="https://www.mlbstatic.com/team-logos/${t.id}.svg" alt="">` : ''}
            <span class="record"></span>
          </div>
          <span class="abbr">${esc(t.abbr||'')}</span>
          <span class="info"></span>
        </div>
        <div></div>
        <div class="right score">${score}</div>
      </div>`;
    }
    function linescoreTable(g){
      const ls = g.linescore; if (!ls) return '';
      const n = ls.n || 9;
      const head = Array.from({length:n}, (_,i)=>`<th>${i+1}</th>`).join('');
      const aCells = Array.from({length:n}, (_,i)=>`<td>${(ls.away[i] ?? '')}</td>`).join('');
      const hCells = Array.from({length:n}, (_,i)=>`<td>${(ls.home[i] ?? '')}</td>`).join('');
      const aT = ls.totals.away, hT = ls.totals.home;
      return `<table>
        <thead><tr><th></th>${head}<th>R</th><th>H</th><th>E</th></tr></thead>
        <tbody>
          <tr><td class="name">${esc(g.teams.away.abbr)}</td>${aCells}<td>${aT.R ?? ''}</td><td>${aT.H ?? ''}</td><td>${aT.E ?? ''}</td></tr>
          <tr><td class="name">${esc(g.teams.home.abbr)}</td>${hCells}<td>${hT.R ?? ''}</td><td>${hT.H ?? ''}</td><td>${hT.E ?? ''}</td></tr>
        </tbody></table>`;
    }
    function tblRows(rows, cols){ return (rows||[]).map(r => `<tr>
      <td class="pos">${esc(r.pos||'')}</td>
      <td class="name">${esc(r.name||'')}</td>
      ${cols.map(c=>`<td>${r[c] ?? ''}</td>`).join('')}
    </tr>`).join(''); }
    function scoringRows(scor, aabbr, habbr){
      if(!(scor&&scor.length)) return `<tr><td colspan="4" class="play">No scoring plays yet.</td></tr>`;
      return scor.map(s => `<tr>
        <td>${s.inning ?? ''}</td>
        <td class="play">${s.by?`<span style="color:#5b6577;font-weight:700;margin-right:6px">${esc(s.by)}</span>`:''}${esc(s.play||'')}</td>
        <td>${s.away ?? ''}</td>
        <td>${s.home ?? ''}</td>
      </tr>`).join('');
    }
    // ---------- Box score helpers (todaysgames style) ----------
    function fmtShortName(nm){
      if (!nm) return '';
      const parts = nm.split(' ');
      return parts.length>1 ? `${parts[0][0]}. ${parts.slice(1).join(' ')}` : nm;
    }
    function fillBatTable(tbodyId, rows){
      const el = $(tbodyId);
      if(!rows || !rows.length){ el.innerHTML = `<tr><td class="when" colspan="8">—</td></tr>`; return; }
      el.innerHTML = rows.map(r => `
        <tr ${r.indent ? 'class="indent"' : ''}>
          <td class="pos">${r.pos||''}</td>
          <td class="name">${fmtShortName(r.name)||''}</td>
          <td>${r.ab ?? ''}</td><td>${r.r ?? ''}</td><td>${r.h ?? ''}</td><td>${r.rbi ?? ''}</td><td>${r.bb ?? ''}</td><td>${r.k ?? ''}</td>
        </tr>`).join('');
    }
    function fillPitTable(tbodyId, rows, decisions){
      const el = $(tbodyId);
      if(!rows || !rows.length){ el.innerHTML = `<tr><td class="when" colspan="10">—</td></tr>`; return; }
      const W = decisions?.winnerId, L = decisions?.loserId, S = decisions?.saveId;
      el.innerHTML = rows.map(r => {
        let name = fmtShortName(r.name)||'';
        let tags = '';
        if (r.pid === W) tags += `<span class="badge-gray">W</span>`;
        if (r.pid === L) tags += `<span class="badge-gray">L</span>`;
        if (r.pid === S) tags += `<span class="badge-gray">SV</span>`;
        if (tags) name += ' ' + tags;
        return `
          <tr ${r.indent ? 'class="indent"' : ''}>
            <td class="pos">${r.pos||'P'}</td>
            <td class="name">${name}</td>
            <td>${r.ip ?? ''}</td><td>${r.h ?? ''}</td><td>${r.r ?? ''}</td><td>${r.er ?? ''}</td><td>${r.bb ?? ''}</td><td>${r.k ?? ''}</td><td>${r.hr ?? ''}</td><td>${r.p ?? ''}</td>
          </tr>`;
      }).join('');
    }

    // ---------- Full-cell gradients (EV, xBA) ----------
    function clamp01(x){ return Math.max(0, Math.min(1, x)); }
    function lerp(a,b,t){ return a + (b-a)*t; }
    function mixColor(c1, c2, t){ return [Math.round(lerp(c1[0], c2[0], t)), Math.round(lerp(c1[1], c2[1], t)), Math.round(lerp(c1[2], c2[2], t))]; }
    const BLUE=[30,58,138], WHITE=[255,255,255], RED=[185,28,28];
    function blueWhiteRed(t){ t=clamp01(t); const c = (t<=.5)? mixColor(BLUE,WHITE,t/.5) : mixColor(WHITE,RED,(t-.5)/.5); return `rgb(${c[0]},${c[1]},${c[2]})`; }
    function textColorFor(rgbStr){
      const m = rgbStr.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/); if(!m) return '#0b0e13';
      const r=+m[1], g=+m[2], b=+m[3]; const L = 0.2126*r+0.7152*g+0.0722*b;
      return L < 150 ? '#ffffff' : '#0b0e13';
    }
    function normEV(ev){ const v=parseFloat(ev); if (isNaN(v)) return null; return clamp01((v-60)/(115-60)); }
    function normXBA(x){
      // accept ".432", "0.432", 0.432, 43.2, 432
      if (x==null || x==='') return null;
      let v = (typeof x==='string' && x.trim().startsWith('.')) ? parseFloat('0'+x) : parseFloat(x);
      if (Number.isNaN(v)) return null;
      if (v > 1.0) v = v/100.0;   // coerce 237 -> 2.37 -> clamp later
      return clamp01(v);
    }
    function fmtXBA(x){
      if (x==null || x==='') return '—';
      let v = (typeof x==='string' && x.trim().startsWith('.')) ? parseFloat('0'+x) : parseFloat(x);
      if (Number.isNaN(v)) return '—';
      if (v > 1.0) v = v/100.0;
      return v.toFixed(3).replace(/^0/, '.');  // single leading dot only
    }
    function fmt1(x){
      if (x == null || x === '') return '—';
      const v = parseFloat(x);
      return Number.isNaN(v) ? '—' : v.toFixed(1);
    }
    function tdWithGrad(displayVal, rawForNorm, normFn){
      const n = normFn(rawForNorm);
      if (n==null) return `<td class="center gradcell">${displayVal}</td>`;
      const bg = blueWhiteRed(n), fg = textColorFor(bg);
      return `<td class="center gradcell" style="background:${bg}; color:${fg}">${displayVal}</td>`;
    }

    // ---------- PBP with expanders ----------
    let playsGlobal = [];

    function renderPBPTable(list){
      const body = $('pbpBody');
      if(!Array.isArray(list) || !list.length){ body.innerHTML = '<tr><td class="when" colspan="6">—</td></tr>'; return; }

      body.innerHTML = list.map((r, idx)=>{
        const evDisp = fmt1(r.ev);
        const xbaDisp = fmtXBA(r.xba);
        const base = `
          <tr class="pbp-row" data-row="${idx}" style="cursor:pointer">
            <td class="center">${r.inning || ''}</td>
            <td>${r.desc || ''}</td>
            ${tdWithGrad(evDisp, r.ev, normEV)}
            <td class="center">${r.la ? r.la + '°' : '—'}</td>
            <td class="center">${r.dist ? r.dist + ' ft' : '—'}</td>
            ${tdWithGrad(xbaDisp, r.xba, normXBA)}
          </tr>
          <tr class="expander" data-exp="${idx}" style="display:none">
            <td colspan="6">
              <div class="expand-wrap">
                <div class="plots">
                  <div class="plot-card">
                    <div class="mini-title">Strike Zone</div>
                    <div id="sz-${idx}"></div>
                    <div class="note">Green = ball • Red = strike/foul • Blue = in play</div>
                  </div>
                </div>
                <div>
                  <div class="mini-title">Pitch-by-Pitch</div>
                  <table class="mini-table">
                    <thead><tr><th>#</th><th>Type</th><th>Velo</th><th>Result</th></tr></thead>
                    <tbody id="ptbl-${idx}"></tbody>
                  </table>
                </div>
              </div>
            </td>
          </tr>
        `;
        return base;
      }).join('');

      // Click to toggle + render charts
      body.querySelectorAll('tr.pbp-row').forEach(tr=>{
        tr.addEventListener('click', ()=>{
          const idx = Number(tr.getAttribute('data-row'));
          const ex = body.querySelector(`tr[data-exp="${idx}"]`);
          const open = ex.style.display !== 'none';
          ex.style.display = open ? 'none' : '';
          if (!open) renderDetails(idx);
        });
      });
    }

    // ---------- Charts ----------
    function drawStrikeZone(container, pitches = []) {
  const el = (typeof container === "string") ? document.getElementById(container) : container;
  if (!el) return;

  // Clear old chart
  el.innerHTML = "";

  // --- SIZE TWEAKS ONLY (bigger canvas, slightly wider x-range) ---
  const pad  = 12;
  const yMin = 0,   yMax = 5;
  const xMin = -2.25, xMax = 2.25;   // was ±2
  const h    = 280;                   // was ~170
  const xRange = xMax - xMin, yRange = yMax - yMin;
  const w = Math.round((xRange / yRange) * h) + pad * 2;

  // SVG
  const NS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(NS, "svg");
  svg.setAttribute("viewBox", `0 0 ${w} ${h + pad * 2}`);
  svg.setAttribute("width", w);
  svg.setAttribute("height", h + pad * 2);
  svg.style.display = "block";
  svg.style.margin = "0 auto"; // center inside the card
  el.appendChild(svg);

  // Scales
  const sx = (x) => pad + ((x - xMin) / xRange) * (w - pad * 2);
  const sy = (y) => pad + ((yMax - y) / yRange) * h;

  // Background (optional subtle frame)
  const bg = document.createElementNS(NS, "rect");
  bg.setAttribute("x", pad);
  bg.setAttribute("y", pad);
  bg.setAttribute("width", w - pad * 2);
  bg.setAttribute("height", h);
  bg.setAttribute("fill", "white");
  bg.setAttribute("stroke", "#e5e7eb");
  svg.appendChild(bg);

  // Strike zone box (typical zone: px ±0.83, pz 1.5–3.5)
  const zoneLeft = -0.83, zoneRight = 0.83, zoneBottom = 1.5, zoneTop = 3.5;
  const zx = sx(zoneLeft);
  const zy = sy(zoneTop);
  const zw = sx(zoneRight) - sx(zoneLeft);
  const zh = sy(zoneBottom) - sy(zoneTop);

  const zone = document.createElementNS(NS, "rect");
  zone.setAttribute("x", zx);
  zone.setAttribute("y", zy);
  zone.setAttribute("width", zw);
  zone.setAttribute("height", zh);
  zone.setAttribute("fill", "none");
  zone.setAttribute("stroke", "#111827");
  zone.setAttribute("stroke-width", "2");
  svg.appendChild(zone);

  // --- Add grid lines for 9 squares ---
  const thirdW = zw / 3;
  const thirdH = zh / 3;

  // Vertical grid lines
  for (let i = 1; i <= 2; i++) {
    const line = document.createElementNS(NS, "line");
    line.setAttribute("x1", zx + i * thirdW);
    line.setAttribute("y1", zy);
    line.setAttribute("x2", zx + i * thirdW);
    line.setAttribute("y2", zy + zh);
    line.setAttribute("stroke", "#111827");
    line.setAttribute("stroke-width", "1");
    svg.appendChild(line);
  }

  // Horizontal grid lines
  for (let i = 1; i <= 2; i++) {
    const line = document.createElementNS(NS, "line");
    line.setAttribute("x1", zx);
    line.setAttribute("y1", zy + i * thirdH);
    line.setAttribute("x2", zx + zw);
    line.setAttribute("y2", zy + i * thirdH);
    line.setAttribute("stroke", "#111827");
    line.setAttribute("stroke-width", "1");
    svg.appendChild(line);
  }

  // --- Home plate (catcher's view) ---
  // Add a vertical gap between strike zone and home plate
const plateGap = zh * 0.1; // adjust this to change the gap size
// Shift the plate down by plateGap
const plateTopY = zy + zh + plateGap;
  const plateTipDrop = zh * 0.15;  // how far tip drops below top edge
  const plateBottomY = plateTopY + plateTipDrop;
  const platePoints = [
    `${zx},${plateTopY}`,                                   // top left
    `${zx + zw},${plateTopY}`,                              // top right
    `${zx + zw * 0.8},${plateBottomY - plateTipDrop / 3}`,  // mid right
    `${zx + zw / 2},${plateBottomY}`,                       // tip
    `${zx + zw * 0.2},${plateBottomY - plateTipDrop / 3}`   // mid left
  ].join(" ");

  const plate = document.createElementNS(NS, "polygon");
  plate.setAttribute("points", platePoints);
  plate.setAttribute("fill", "#f3f4f6");
  plate.setAttribute("stroke", "#111827");
  plate.setAttribute("stroke-width", "2");
  svg.appendChild(plate);

  // Pitch dots
  const colorFor = (p) => {
    if (p && p.inPlay) return "#2563eb";              // blue for ball in play
    const code = (p && p.code) ? String(p.code) : "";
    if (code === "B" || code === "I") return "#16a34a"; // green for balls
    return "#dc2626";                                  // red for strikes/fouls/others
  };

  pitches.forEach((p, i) => {
    if (p == null || p.px == null || p.pz == null) return;

    const cx = sx(p.px);
    const cy = sy(p.pz);

    // Dot (slightly bigger to match larger canvas)
    const circ = document.createElementNS(NS, "circle");
    circ.setAttribute("cx", cx);
    circ.setAttribute("cy", cy);
    circ.setAttribute("r", 6); // was ~4.5
    circ.setAttribute("fill", colorFor(p));
    circ.setAttribute("opacity", "0.9");
    svg.appendChild(circ);

    // Index label
    const label = document.createElementNS(NS, "text");
    label.setAttribute("x", cx);
    label.setAttribute("y", cy + 3.8);
    label.setAttribute("text-anchor", "middle");
    label.setAttribute("font-size", "9.5"); // was ~7.5
    label.setAttribute("font-family", "ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial");
    label.setAttribute("fill", "#111827");
    label.textContent = String(i + 1);
    svg.appendChild(label);
  });
}


    function fillPitchMiniTable(el, pitches){
      el.innerHTML = (pitches||[]).map((p,i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${p.type || ''}</td>
          <td>${fmt1(p.velo)}</td>
          <td>${p.result || ''}</td>
        </tr>
      `).join('') || `<tr><td colspan="4" class="when">No pitch data</td></tr>`;
    }

    function renderDetails(idx){
      const play = playsGlobal[idx] || {};
      // Chart
      drawStrikeZone($(`sz-${idx}`), play.pitches || []);
      // Table
      fillPitchMiniTable($(`ptbl-${idx}`), play.pitches || []);
    }

    // ---------- Load & wire up ----------
    async function load(){
      const data = await getGame();
      const g = data.game || {};
      document.getElementById('title').textContent = `${g.teams?.away?.abbr||''} @ ${g.teams?.home?.abbr||''}`;
      document.getElementById('venue').textContent = g.venue || '';
      document.getElementById('chip').innerHTML = chip(g.status, g.chip);

      document.getElementById('rows').innerHTML = teamRow('away', g.teams.away) + teamRow('home', g.teams.home);

      const cnt = g.count || {};
      const bs = (cnt.balls!=null && cnt.strikes!=null) ? `${cnt.balls}-${cnt.strikes}` : '';
      const o = (cnt.outs!=null) ? `${cnt.outs} out${cnt.outs===1?'':'s'}` : '';
      document.getElementById('count').textContent = [bs,o].filter(Boolean).join(', ');

      const last = g.lastPlay ? `<div class="lastplay"><strong>Last Play:</strong> ${esc(g.lastPlay)}</div>` : '';
      document.getElementById('lastplay').innerHTML = last;
      document.getElementById('statcast').textContent = g.statcast || '';

      document.querySelector('#scoresum .wrap').innerHTML =
        `<table><thead><tr><th>Inning</th><th class="play">Play</th><th>${esc(g.teams.away.abbr)}</th><th>${esc(g.teams.home.abbr)}</th></tr></thead><tbody>${scoringRows(g.scoring, g.teams.away.abbr, g.teams.home.abbr)}</tbody></table>`;

      document.getElementById('linescore').innerHTML = linescoreTable(g);

      document.getElementById('batAwayHdr').textContent = `${g.teams.away.abbr} — Batting`;
      document.getElementById('batHomeHdr').textContent = `${g.teams.home.abbr} — Batting`;
      document.getElementById('pitAwayHdr').textContent = `${g.teams.away.abbr} — Pitching`;
      document.getElementById('pitHomeHdr').textContent = `${g.teams.home.abbr} — Pitching`;

      document.getElementById('batAway').innerHTML = tblRows(g.batters?.away, ['ab','r','h','rbi','bb','k']);
      document.getElementById('batHome').innerHTML = tblRows(g.batters?.home, ['ab','r','h','rbi','bb','k']);
      document.getElementById('pitAway').innerHTML = tblRows(g.pitchers?.away, ['ip','h','r','er','bb','k','hr','p']);
      document.getElementById('pitHome').innerHTML = tblRows(g.pitchers?.home, ['ip','h','r','er','bb','k','hr','p']);

      const awayLU = (g.lineups?.away||[]).slice(0,9).map(x=>`<div>${esc((x.pos||'').toUpperCase())} — ${esc(x.name||'')}</div>`).join('') || `<em>Lineup not yet available.</em>`;
      const homeLU = (g.lineups?.home||[]).slice(0,9).map(x=>`<div>${esc((x.pos||'').toUpperCase())} — ${esc(x.name||'')}</div>`).join('') || `<em>Lineup not yet available.</em>`;
      document.getElementById('luAway').innerHTML = awayLU;
      document.getElementById('luHome').innerHTML = homeLU;

      const dec = data.meta?.decisionsText || '';
      if (dec){
        const el = document.createElement('div');
        el.style.cssText = 'padding:8px 12px;border-top:1px solid var(--border);background:#fff;font-size:12px;color:#394150;font-weight:600';
        el.textContent = dec;
        document.getElementById('box').insertAdjacentElement('afterbegin', el);
      }

      if (g.status === 'in_progress'){
        setTimeout(load, 30000);
      }
    }
    load();
  </script>
</body>
</html>

