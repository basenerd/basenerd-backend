<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ game.away.name }} @ {{ game.home.name }} — Game Report</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --muted:#5b6577; --text:#111318; --accent:#0b5cab;
      --row:#fafbfc; --rowAlt:#f4f6f9; --border:#e2e8f0; --subtle:#8a94ab;
      --chip-live:#e21d48; --chip-final:#32425c; --chip-upcoming:#6b7a94;
      --badge:#eef0f4; --badge-text:#394150;
      --ball:#16a34a;   /* green */
      --strike:#dc2626; /* red */
      --inplay:#2563eb; /* blue */
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--text); font-family:"IBM Plex Sans",-apple-system,Segoe UI,Roboto,Arial; }
    .wrap{ max-width:1150px; margin:20px auto; padding:0 14px; }
    /* styles unchanged... */
    .plots{ display:grid; grid-template-columns:1fr; gap:14px; }
    .plot-card{ border:1px solid var(--border); border-radius:10px; padding:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- header, linescore, boxes all unchanged from working version -->
    <!-- Play by Play -->
    <div class="card pbp-card">
      <h3>Play by Play</h3>
      <div style="overflow:auto">
        <table class="pbp-table" id="pbpTable">
          <thead>
            <tr>
              <th style="width:76px">Inning</th>
              <th>Play</th>
              <th class="center" style="width:90px">EV</th>
              <th class="center" style="width:70px">LA</th>
              <th class="center" style="width:80px">Dist</th>
              <th class="center" style="width:90px">xBA</th>
            </tr>
          </thead>
          <tbody id="pbpBody"><tr><td class="when" colspan="6">Loading…</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    // all helper functions unchanged...
    function drawStrikeZone(el, pitches){
      const w = 160, h = 180, pad = 8; // smaller card
      const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
      svg.setAttribute("width", w); svg.setAttribute("height", h);
      svg.style.background = "#ffffff";
      const g = document.createElementNS(svg.namespaceURI,"g");
      svg.appendChild(g);
      const xMap = x => pad + ((x+2)/(4.0))*(w-2*pad); // wider horizontal range
      const yMap = z => h-pad - ((z-0)/(5.0))*(h-2*pad);
      let tops = [], bots = [];
      pitches.forEach(p => {
        if (p.sz_top!=null) tops.push(Number(p.sz_top));
        if (p.sz_bot!=null) bots.push(Number(p.sz_bot));
      });
      const zTop = tops.length ? tops.reduce((a,b)=>a+b)/tops.length : 3.5;
      const zBot = bots.length ? bots.reduce((a,b)=>a+b)/bots.length : 1.5;
      const zLeft = xMap(-0.83), zRight = xMap(0.83), zTopY = yMap(zTop), zBotY = yMap(zBot);
      const rect = document.createElementNS(svg.namespaceURI,"rect");
      rect.setAttribute("x", zLeft); rect.setAttribute("y", zTopY);
      rect.setAttribute("width", zRight - zLeft); rect.setAttribute("height", zBotY - zTopY);
      rect.setAttribute("fill","none"); rect.setAttribute("stroke","#94a3b8"); rect.setAttribute("stroke-width","1.5");
      g.appendChild(rect);
      for (let i=1;i<=2;i++){
        const v = document.createElementNS(svg.namespaceURI,"line");
        v.setAttribute("x1", zLeft + ((zRight - zLeft)/3)*i); v.setAttribute("y1", zTopY);
        v.setAttribute("x2", zLeft + ((zRight - zLeft)/3)*i); v.setAttribute("y2", zBotY);
        v.setAttribute("stroke", "#cbd5e1"); g.appendChild(v);
        const hline = document.createElementNS(svg.namespaceURI,"line");
        hline.setAttribute("x1", zLeft); hline.setAttribute("y1", zTopY + ((zBotY - zTopY)/3)*i);
        hline.setAttribute("x2", zRight); hline.setAttribute("y2", zTopY + ((zBotY - zTopY)/3)*i);
        hline.setAttribute("stroke", "#cbd5e1"); g.appendChild(hline);
      }
      pitches.forEach((p,i)=>{
        if (p.px==null || p.pz==null) return;
        const code = (p.code||"").toUpperCase();
        let color = "var(--strike)";
        if (p.inPlay) color = "var(--inplay)"; else if (code === "B") color = "var(--ball)";
        const cx = xMap(Number(p.px));
        const cy = yMap(Number(p.pz));
        const circ = document.createElementNS(svg.namespaceURI,"circle");
        circ.setAttribute("cx", cx); circ.setAttribute("cy", cy);
        circ.setAttribute("r", 4.5);
        circ.setAttribute("fill", color); circ.setAttribute("opacity", "0.95");
        circ.setAttribute("stroke", "#111318"); circ.setAttribute("stroke-width", "0.5");
        g.appendChild(circ);
        const label = document.createElementNS(svg.namespaceURI,"text");
        label.setAttribute("x", cx); label.setAttribute("y", cy + 0.5);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("dominant-baseline", "middle");
        label.setAttribute("font-size", "7.5"); label.setAttribute("font-weight", "700");
        label.setAttribute("fill", "#ffffff");
        label.setAttribute("stroke", "#111318"); label.setAttribute("stroke-width", "0.5");
        label.textContent = String(i+1);
        g.appendChild(label);
      });
      el.innerHTML = ""; el.appendChild(svg);
    }
    // rest of JS unchanged from working version...
  </script>
</body>
</html>
