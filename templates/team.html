{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="card-header">
    <div class="teamcell" style="gap:10px;">
      {% if team.logo_url %}
        <img class="teamlogo" src="{{ team.logo_url }}" alt="{{ team.name }} logo" style="height:28px;">
      {% endif %}
      <div>
        <div class="card-title">{{ team.name }}</div>
        <div class="card-subtitle">
          {% if team.league %}{{ team.league }}{% endif %}
          {% if team.division %} • {{ team.division }}{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card-body">
    <table class="table">
      <tbody>
        <tr><td><strong>Abbreviation</strong></td><td>{{ team.abbrev }}</td></tr>
        <tr><td><strong>Location</strong></td><td>{{ team.location }}</td></tr>
        <tr><td><strong>Ballpark</strong></td><td>{{ team.venue }}</td></tr>
        <tr><td><strong>First year</strong></td><td>{{ team.first_year }}</td></tr>
      </tbody>
    </table>
  </div>
</div>


<!-- ===================== -->
<!-- 40-MAN ROSTER DROPDOWN -->
<!-- ===================== -->

<div class="card" style="margin-top:18px;">
  <div class="card-header">
    <details class="roster-details">
      <summary class="roster-summary">
        <div class="card-title" style="margin:0;">40-Man Roster</div>
        <span class="muted" style="font-size:12px;">Click to expand</span>
      </summary>

      <div class="card-body" style="padding-top:10px;">

        {% set bucket_label = {
          "Pitcher": "Pitchers",
          "Catcher": "Catchers",
          "Infielder": "Infielders",
          "Outfielder": "Outfielders",
          "Two-Way": "Two-Way Players"
        } %}

        {% for bucket, pos_map in (roster_grouped or {}).items() %}
          {% if pos_map %}
            <div class="subcard" style="margin-top:12px;">
              <div class="subcard-title">{{ bucket_label.get(bucket, bucket ~ "s") }}</div>

              <!-- Inside each bucket, make each POSITION its own mini-card/table -->
              {% for pos, players in pos_map.items() %}
                <div class="subcard" style="margin-top:10px;">
                  <div class="subcard-title" style="opacity:0.9;">{{ pos }}</div>

                  <table class="table">
                    <thead>
                      <tr>
                        <td style="width:44px; text-align:right;"><strong>#</strong></td>
                        <td><strong>Player</strong></td>
                        <td style="width:70px; text-align:right;"><strong>B/T</strong></td>
                        <td style="width:60px; text-align:right;"><strong>Pos</strong></td>
                        <td style="width:74px; text-align:right;"><strong>Status</strong></td>
                      </tr>
                    </thead>
                    <tbody>
                      {% for p in players %}
                        <tr>
                          <td style="text-align:right; font-variant-numeric: tabular-nums;">
                            {{ p.jersey or "—" }}
                          </td>
                          <td>{{ p.name }}</td>
                          <td style="text-align:right; font-variant-numeric: tabular-nums;">
                            {{ p.bt or "—" }}
                          </td>
                          <td style="text-align:right;">
                            {{ p.pos or "—" }}
                          </td>
                          <td style="text-align:right;">
                            {% if p.status_code and p.status_code not in ["A"] %}
                              <span style="
                                display:inline-block;
                                padding:2px 8px;
                                border-radius:999px;
                                background: rgba(255,255,255,0.10);
                                font-size:11px;
                              " title="{{ p.status_desc }}">
                                {{ p.status_code }}
                              </span>
                            {% else %}
                              <span class="muted">—</span>
                            {% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% endfor %}

            </div>
          {% endif %}
        {% endfor %}

        {% if roster_other %}
          <div class="subcard" style="margin-top:12px;">
            <div class="subcard-title">Other</div>

            {% for pos, players in roster_other.items() %}
              <div class="subcard" style="margin-top:10px;">
                <div class="subcard-title" style="opacity:0.9;">{{ pos }}</div>

                <table class="table">
                  <thead>
                    <tr>
                      <td style="width:44px; text-align:right;"><strong>#</strong></td>
                      <td><strong>Player</strong></td>
                      <td style="width:70px; text-align:right;"><strong>B/T</strong></td>
                      <td style="width:60px; text-align:right;"><strong>Pos</strong></td>
                      <td style="width:74px; text-align:right;"><strong>Status</strong></td>
                    </tr>
                  </thead>
                  <tbody>
                    {% for p in players %}
                      <tr>
                        <td style="text-align:right; font-variant-numeric: tabular-nums;">{{ p.jersey or "—" }}</td>
                        <td>{{ p.name }}</td>
                        <td style="text-align:right;">{{ p.bt or "—" }}</td>
                        <td style="text-align:right;">{{ p.pos or "—" }}</td>
                        <td style="text-align:right;">
                          {% if p.status_code %}
                            <span style="
                              display:inline-block;
                              padding:2px 8px;
                              border-radius:999px;
                              background: rgba(255,255,255,0.10);
                              font-size:11px;
                            " title="{{ p.status_desc }}">
                              {{ p.status_code }}
                            </span>
                          {% else %}
                            <span class="muted">—</span>
                          {% endif %}
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>

              </div>
            {% endfor %}
          </div>
        {% endif %}

      </div>
    </details>
  </div>
</div>

<!-- tiny styles local to this page only -->
<style>
  /* Make summary look like your card header row */
  .roster-details { width: 100%; }
  .roster-summary {
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 12px;
    padding: 0; /* card-header already provides spacing */
    list-style: none;
  }
  .roster-summary::-webkit-details-marker { display: none; }
</style>

{% endblock %}
