{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="card-header" style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
    <div>
      <div class="card-title">Games</div>
      <div class="card-subtitle">
        Showing {{ date }}{% if auto_advanced %} • No games today — jumped to next slate{% endif %}
        • Times in {{ user_tz }}
      </div>
    </div>

    <form method="get" action="/games" style="display:flex; gap:10px; align-items:center;">
      <button type="button" class="date-arrow" id="prev-date">&lsaquo;</button>
      <input class="input" type="date" name="date" value="{{ date }}" aria-label="Pick date" />
      <button type="button" class="date-arrow" id="next-date">&rsaquo;</button>
      <button class="btn" type="submit">Go</button>
    </form>
  </div>
</div>

{% if not games %}
  <div class="card" style="margin-top:14px;">
    <div class="card-header">
      <div class="card-title">No games found</div>
      <div class="card-subtitle">Try another date.</div>
    </div>
  </div>
{% else %}
  <div class="games-grid" style="margin-top:14px;">
    {% for g in games %}
      <a class="game-card" href="/game/{{ g.gamePk }}">

        <div class="game-card-top">
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
            {% if g.competitionLabel %}
              <div class="tag">{{ g.competitionLabel }}</div>
            {% endif %}
            <div class="pill">{{ g.statusPill }}</div>
          </div>
          <div class="muted mono game-time">{{ g.timeLocal }}</div>
        </div>

        <div class="matchup">

          <!-- AWAY -->
          <div class="team-row">
            <div class="team-left">
              {% if g.away.logo %}
                <img class="team-logo" src="{{ g.away.logo }}" alt="{{ g.away.abbrev }} logo">
              {% endif %}

              <div class="team-line">
                <div class="team-line-top">
                  <span class="team-abbrev">{{ g.away.abbrev }}</span>
                  {% if g.away.record %}
                    <span class="muted mono" style="font-size:12px;">{{ g.away.record }}</span>
                  {% endif %}
                  <span class="muted" style="opacity:.6;">•</span>
                  <span class="small muted">{{ g.away.slot or "—" }}</span>
                </div>
              </div>
            </div>

            <div class="team-score mono">{{ g.away.score if g.away.score is not none else "—" }}</div>
          </div>

          <!-- HOME -->
          <div class="team-row">
            <div class="team-left">
              {% if g.home.logo %}
                <img class="team-logo" src="{{ g.home.logo }}" alt="{{ g.home.abbrev }} logo">
              {% endif %}

              <div class="team-line">
                <div class="team-line-top">
                  <span class="team-abbrev">{{ g.home.abbrev }}</span>
                  {% if g.home.record %}
                    <span class="muted mono" style="font-size:12px;">{{ g.home.record }}</span>
                  {% endif %}
                  <span class="muted" style="opacity:.6;">•</span>
                  <span class="small muted">{{ g.home.slot or "—" }}</span>
                </div>
              </div>
            </div>

            <div class="team-score mono">{{ g.home.score if g.home.score is not none else "—" }}</div>
          </div>

        </div>

        <div class="game-meta">

          {% if g.venue %}
            <div class="muted">
              {{ g.venue }}
              {% if g.venueLocation %}
                • {{ g.venueLocation }}
              {% endif %}
            </div>
          {% endif %}

          <div class="small muted">{{ g.detailedState }}</div>
        </div>

      </a>
    {% endfor %}
  </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const prevBtn = document.getElementById('prev-date');
    const nextBtn = document.getElementById('next-date');
    const dateInput = document.querySelector('input[type="date"]'); 

    function adjustDate(days) {
        if (!dateInput || !dateInput.value) return;
        
        const currentDate = new Date(dateInput.value + 'T00:00:00');
        currentDate.setDate(currentDate.getDate() + days);
        
        const yyyy = currentDate.getFullYear();
        const mm = String(currentDate.getMonth() + 1).padStart(2, '0');
        const dd = String(currentDate.getDate()).padStart(2, '0');
        
        dateInput.value = `${yyyy}-${mm}-${dd}`;
        
        if (dateInput.form) {
            dateInput.form.submit();
        }
    }

    if (prevBtn) prevBtn.addEventListener('click', () => adjustDate(-1));
    if (nextBtn) nextBtn.addEventListener('click', () => adjustDate(1));
});
</script>

{% endblock %}
